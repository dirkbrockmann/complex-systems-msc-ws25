import{j as y,s as I}from"./transform.D34fbgXt.js";import{u as K,l as P,m as $,p as L,a as N}from"./map.q80aMCoh.js";import{r as _}from"./index.BVOCwoKb.js";import{s as l}from"./styles_module.329d2593.BnZBF5Q1.js";import{r as B}from"./range.DsrFyqpl.js";import{f as F}from"./forEach.DJv7UHbC.js";import{a as X,b as Y,l as H}from"./line.CHfAYkri.js";const W=(c,f,n,r)=>{r=r||{};for(var m=r.tolerance||1e-7,e=r.epsilon||1e-12,w=r.maxIterations||100,s,o=0;o<w;++o){var x=f(n);if(Math.abs(x)<e)return!1;s=n-c(n)/x;var u=Math.abs(s-n)<m;if(u)return s;n=s}return!1};function C(c,f,n,r={}){const m=r.numPoints||100,e=r.tolerance||1e-6,w=r.noise||1e-7,[s,o]=n,x=(o-s)/(m+1),u=[];for(let d=1;d<=m;d++){let i=s+d*x;i+=(Math.random()*2-1)*w,i=Math.max(s,Math.min(o,i));const h=W(c,f,i,r);h!==!1&&typeof h=="number"&&isFinite(h)&&h>=s-e&&h<=o+e&&!u.some(b=>Math.abs(b-h)<e)&&u.push(h)}return u.sort((d,i)=>d-i)}const a={container:{class:"flex flex-col "},display:{width:600,height:300,class:" p-0  mb-0 w-full h-auto"},controls:{width:600,height:120,class:"d3-widgets p-0  mb-0 w-full h-auto ",grid:{x:12,y:6}},plot:{arrow_scale:1,number_of_arrows:10,fixpointradius:8,margin:{l:40,r:10,t:10,b:10},xr:[0,2*Math.PI],yr:[-1,1]},widgets:{slider_size:500,slider_girth:8,slider_knob:9,slider_fontsize:14,sliders:[{id:"omega",label:"δω",range:[0,1],value:.25,position:{x:1,y:2},show:!0},{id:"K",label:"K",range:[0,1],value:.5,position:{x:1,y:5},show:!0}]}},q=(c,f)=>{const n=K(a.controls.width,a.controls.height,a.controls.grid.x,a.controls.grid.y),r=I(c),m=I(f),e=a.plot.xr,w=a.plot.yr,s=P().domain(e).range([a.plot.margin.l,a.display.width-a.plot.margin.r]),o=P().domain(w).range([a.display.height-a.plot.margin.b,a.plot.margin.t]),x=X(s),u=Y(o),d=H().x(t=>s(t.x)).y(t=>o(t.y));r.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","-0 -5 10 10").attr("refX",5).attr("refY",0).attr("orient","auto").attr("markerWidth",3).attr("markerHeight",3).attr("xoverflow","visible").append("svg:path").attr("d","M 0,-5 L 10 ,0 L 0,5").attr("fill","black").style("stroke","none");const i=$(a.widgets.sliders,t=>N().id(t.id).label(t.label).range(t.range).value(t.value).fontsize(a.widgets.slider_fontsize).size(a.widgets.slider_size).girth(a.widgets.slider_girth).knob(a.widgets.slider_knob).show(t.show).position(n.position(t.position.x,t.position.y)));m.selectAll(null).data(i).enter().append(L);const h=i[0],b=i[1],p=t=>h.value()-b.value()*Math.sin(t),M=t=>-b.value()*Math.cos(t),g=(e[1]-e[0])/a.plot.number_of_arrows,A=B(e[0],e[1],g);console.log(A.length*g),console.log(g);const v=a.plot.arrow_scale;var k=$(B(e[0],e[1],(e[1]-e[0])/200),t=>({x:t,y:p(t)})),R=C(p,M,[0,2*Math.PI]);const E=()=>{R=C(p,M,[0,2*Math.PI]),k=$(B(e[0],e[1],(e[1]-e[0])/200),t=>({x:t,y:p(t)})),r.selectAll("."+l.fixpoint).remove(),r.selectAll("."+l.fixpoint).data(R).enter().append("circle").attr("class",l.fixpoint).attr("r",a.plot.fixpointradius).attr("transform",function(t){return"translate("+s(t)+","+o(0)+")"}).classed(l.stable,t=>M(t)<0),r.select("."+l.curve).datum(k).attr("d",d),r.selectAll("."+l.arrow).data(A).attr("d",t=>{let j=v*Math.abs(p(t))>1?g*Math.sign(p(t)):v*p(t)*g,z=[{x:t,y:0},{x:t+j,y:0}];return d(z)})};return F(i,t=>t.update(E)),console.log(R),r.append("g").call(x).attr("class",l.xaxis).attr("transform","translate(0,"+o(0)+")"),r.append("g").call(u).attr("class",l.yaxis).attr("transform","translate("+s(0)+",0)"),r.append("text").text("x").attr("class",l.axis_label).attr("transform","translate("+s(6)+","+(o(0)+30)+")"),r.append("text").text("f(x)").attr("class",l.axis_label).attr("transform","translate("+(s(0)+20)+","+(o(1)+10)+")"),r.append("path").datum(k).attr("d",d).attr("class",l.curve),r.selectAll("."+l.arrow).data(A).enter().append("path").attr("d",t=>{let j=v*Math.abs(p(t))>1?g*Math.sign(p(t)):v*p(t)*g,z=[{x:t,y:0},{x:t+j,y:0}];return d(z)}).attr("class",l.arrow).attr("marker-end","url(#arrowhead)"),E(),()=>{m.selectAll("*").remove(),r.selectAll("*").remove()}},U=({id:c})=>{const f=_.useRef(null),n=_.useRef(null),r=_.useRef(null);return _.useEffect(()=>q(n.current,r.current),[c]),y.jsx(y.Fragment,{children:y.jsxs("div",{ref:f,id:c,className:a.container.class,children:[y.jsx("svg",{ref:n,id:`${c}-display`,className:a.display.class,width:a.display.width,height:a.display.height,viewBox:`0 0 ${a.display.width} ${a.display.height}`}),y.jsx("svg",{ref:r,id:`${c}-controls`,className:a.controls.class,width:a.controls.width,height:a.controls.height,viewBox:`0 0 ${a.controls.width} ${a.controls.height}`})]})})};export{U as default};
